<h2>Account</h2>


<div id="1-NOT-CONNECTED" *ngIf="!isConnected && currentView === 'main'" class="not-connected-message">
    <h3>You are not connected</h3>
    <p class="p_form">Please login or register to access your account page.</p>
    <div class = "centered">
        <button class="account_btn" (click)="setView('register')">Register</button>
        <button class="account_btn" (click)="setView('login')">Login</button>
    </div>
</div> 

<div class = "account_form_content" id="2-REGISTER" *ngIf="!isConnected && currentView === 'register'">
    <h3>Register</h3>
    <p class="p_form">To register, please fill in the form below.</p>
    
    <form (ngSubmit)="onRegister()">
        <mat-form-field appearance="fill">
            <mat-label >Firstname</mat-label>
            <input matInput required [(ngModel)]="firstname" name="firstname" autocomplete="firstname"/>
        </mat-form-field>
        <mat-form-field appearance="fill">
            <mat-label>Lastname</mat-label>
            <input matInput required [(ngModel)]="lastname" name="lastname" autocomplete="lastname"/>
        </mat-form-field>
        <mat-form-field appearance="fill">
            <mat-label>Email</mat-label>
            <input matInput required [(ngModel)]="email" name="email" autocomplete="email"/>
        </mat-form-field>
        <mat-form-field appearance="fill">
        <mat-label>Password</mat-label>
        <input matInput [type]="hidePassword ? 'password' : 'text'" required [(ngModel)]="password" name="password" autocomplete="current-password"/>
        <button mat-icon-button matSuffix type="button" (click)="hidePassword = !hidePassword">
            <mat-icon>{{hidePassword ? 'visibility_off' : 'visibility'}}</mat-icon>
        </button>
        </mat-form-field>
        <div class="centered">
            <div style="width:100%;">
                <mat-checkbox [(ngModel)]="hasAcceptedTerms" name="hasAcceptedTerms" required>
                    <p> I have read and accept the <a href="#" (click)="openSecurityPolicyModal($event)">security policy</a>.</p>
                </mat-checkbox>
            </div>
        </div>
        <div class = "centered">
            <button class="account_back_btn" mat-button type="button" (click)="goBack()">Back</button>
        </div>
        
        <div class="centered">
            <button class="account_btn" type="submit" [disabled]="!hasAcceptedTerms">Register</button>
        </div>
    </form>
</div>




<div class = "account_form_content"  id="3-LOGIN" *ngIf="!isConnected && currentView === 'login'">
    <h3>Login form</h3>
    <p class="p_form">Please fill the fields below to connect.</p> 
    <form (ngSubmit)="onLogin()">
        <mat-form-field appearance="fill">
            <mat-label>Username</mat-label>
            <input matInput required [(ngModel)]="username" name="username" autocomplete="username"/>
        </mat-form-field>
        <mat-form-field appearance="fill">
        <mat-label>Password</mat-label>
        <input matInput [type]="hidePassword ? 'password' : 'text'" required [(ngModel)]="password" name="password" autocomplete="current-password"/>
        <button mat-icon-button matSuffix type="button" (click)="hidePassword = !hidePassword">
            <mat-icon>{{hidePassword ? 'visibility_off' : 'visibility'}}</mat-icon>
        </button>
        </mat-form-field>
        <div class="centered">
            <button class="account_btn" type="submit">Login</button>
        </div>
        </form>
    <p>Don't have an account? <a href="#" (click)="currentView = 'register'; $event.preventDefault()">Register here</a></p>
    <button class="account_back_btn" mat-button type="button" (click)="goBack()">Back</button>
</div>


<!-- When a standard user without privileges is connected : -->
<div *ngIf="isConnected" class="account-container">
    <div class="left-panel">
        <button class="button" mat-button (click)="onEditInfo()">Edit My Information</button>
        <button class="button" mat-button (click)="onViewCarts()">My Carts</button>
        <button class="button" mat-button (click)="onViewPayments()">My Last Payments</button>
        <button class="button" mat-button (click)="onViewTickets()">My Tickets</button>
        <button class="button" mat-button (click)="onDisconnect()">Disconnect</button>
        
        <!-- Administration section, visible only for role_id 1 or 2 -->
        <ng-container *ngIf="role_id === 1 || role_id === 2">
            <div class="admin-section">
                <h4>Administration</h4>
                <button class="button" mat-button (click)="onManageEvents()">Manage Events</button>
                <button class="button" mat-button (click)="onManageOffers()">Manage Offers</button>
                <button class="button" mat-button (click)="onOffersSold()">Offers Sold</button>
            </div>
        </ng-container>
    </div>
    <div class="right-panel">
        <div class = "account_form_content" width = "100%">
            <h2 *ngIf="currentView === 'main'" style="text-align:center;">Welcome, {{username}} !</h2>
            <ng-container *ngIf="currentView === 'editInfo'">
                <h3>Editing my informations</h3>
                <!-- Form for editing user information -->
                <form (ngSubmit)="onSaveInfo()">
                    <mat-form-field appearance="fill">
                        <mat-label>First Name</mat-label>
                        <input matInput required [(ngModel)]="firstname" name="firstName" />
                    </mat-form-field>

                    <mat-form-field appearance="fill">
                        <mat-label>Last Name</mat-label>
                        <input matInput required [(ngModel)]="lastname" name="lastName" />
                    </mat-form-field>

                       <mat-form-field appearance="fill">
                        <mat-label>Username</mat-label>
                        <input matInput [(ngModel)]="username" name="username" disabled autocomplete="username" readonly />
                    </mat-form-field>

                    <mat-form-field appearance="fill">
                        <mat-label>Email</mat-label>
                        <input matInput required [(ngModel)]="email" name="email" />
                    </mat-form-field>

                    <mat-form-field appearance="fill">
                        <mat-label>Password</mat-label>
                        <input matInput [type]="hidePassword ? 'password' : 'text'" [(ngModel)]="password" name="password" autocomplete="current-password" />
                        <button mat-icon-button matSuffix type="button" (click)="hidePassword = !hidePassword">
                            <mat-icon>{{hidePassword ? 'visibility_off' : 'visibility'}}</mat-icon>
                        </button>
                    </mat-form-field>

                    <mat-form-field appearance="fill">
                        <mat-label>Phone Number</mat-label>
                        <input matInput required [(ngModel)]="phoneNumber" name="phoneNumber" />
                    </mat-form-field>
                    <mat-form-field appearance="fill">
                        <mat-label>Address</mat-label>
                        <textarea matInput [(ngModel)]="address" name="address"></textarea>
                    </mat-form-field>
                    <mat-form-field appearance="fill">
                        <mat-label>City</mat-label>
                        <input matInput [(ngModel)]="city" name="city" />
                    </mat-form-field>
                    <mat-form-field appearance="fill">
                        <mat-label>Postal Code</mat-label>
                        <input matInput [(ngModel)]="postalCode" name="postalCode" />
                    </mat-form-field>
                    <mat-form-field appearance="fill">
                        <mat-label>Country</mat-label>
                        <mat-select [(ngModel)]="country" name="country">
                            <mat-option *ngFor="let country of countries" [value]="country.code">
                                {{ country.name }}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                    <div class="centered">
                        <button class="account_btn" type="submit">Save</button>
                    </div>
                </form>
            </ng-container>
        </div>

 <!-- Cart Panel -->       
<ng-container *ngIf="currentView === 'carts'">
  <h3>My Carts</h3>
  <div *ngIf="userCarts?.length; else noCarts">
    <!-- Table 1: Properties in header, values in a single row -->
    <h2>Selected Offer :</h2>
    <table mat-table [dataSource]="cartOfferDetails" class="mat-elevation-z1" style="width:100%;">
  <ng-container matColumnDef="name">
    <th mat-header-cell *matHeaderCellDef>Name</th>
    <td mat-cell *matCellDef="let row">{{ row.name }}</td>
  </ng-container>
  <ng-container matColumnDef="discountRate">
    <th mat-header-cell *matHeaderCellDef>Discount Rate</th>
    <td mat-cell *matCellDef="let row">{{ row.discountRate }}</td>
  </ng-container>
  <ng-container matColumnDef="nbSpectators">
    <th mat-header-cell *matHeaderCellDef>Impacted Spectators</th>
    <td mat-cell *matCellDef="let row">{{ row.nbSpectators }}</td>
  </ng-container>
  <tr mat-header-row *matHeaderRowDef="['name', 'discountRate', 'nbSpectators']"></tr>
  <tr mat-row *matRowDef="let row; columns: ['name', 'discountRate', 'nbSpectators'];"></tr>
</table>

    <!-- Table 2: Properties in left column, values in right column -->
    <h2>Selected Event :</h2>
    <table mat-table [dataSource]="cartEventDetails" class="mat-elevation-z1" style="width:100%;">
      <ng-container matColumnDef="property">
        <th mat-header-cell *matHeaderCellDef>Property</th>
        <td mat-cell *matCellDef="let element">{{ element.property }}</td>
      </ng-container>
      <ng-container matColumnDef="value">
        <th mat-header-cell *matHeaderCellDef>Value</th>
        <td mat-cell *matCellDef="let element">{{ element.value }}</td>
      </ng-container>
      <tr mat-header-row *matHeaderRowDef="['property', 'value']"></tr>
      <tr mat-row *matRowDef="let row; columns: ['property', 'value'];"></tr>
    </table>

    <!-- Table 3: Properties in header, values in a single row -->
    <h2>Selected Conditions :</h2>
    <table mat-table [dataSource]="[userCarts[0]]" class="mat-elevation-z1" style="width:100%;">
      <ng-container matColumnDef="nbPersons">
        <th mat-header-cell *matHeaderCellDef>Nb of Persons</th>
        <td mat-cell *matCellDef="let cart">{{ cart?.nbPersons }}</td>
      </ng-container>
      <ng-container matColumnDef="classOfSeats">
        <th mat-header-cell *matHeaderCellDef>Class of seats</th>
        <td mat-cell *matCellDef="let cart">{{ cart?.classOfSeats }}</td>
      </ng-container>
      <tr mat-header-row *matHeaderRowDef="['nbPersons', 'classOfSeats']"></tr>
      <tr mat-row *matRowDef="let row; columns: ['nbPersons', 'classOfSeats'];"></tr>
    </table>

    <!-- Table 4: Properties in left column, values in right column -->
    <h2>Coast :</h2>
    <table mat-table [dataSource]="cartCoastDetails" class="mat-elevation-z1" style="width:100%;">
      <ng-container matColumnDef="property">
        <th mat-header-cell *matHeaderCellDef>Property</th>
        <td mat-cell *matCellDef="let element">{{ element.property }}</td>
      </ng-container>
      <ng-container matColumnDef="value">
        <th mat-header-cell *matHeaderCellDef>Value</th>
        <td mat-cell *matCellDef="let element">{{ element.value }}</td>
      </ng-container>
      <tr mat-header-row *matHeaderRowDef="['property', 'value']"></tr>
      <tr mat-row *matRowDef="let row; columns: ['property', 'value'];"></tr>
    </table>
  </div>
  <ng-template #noCarts>
    <p>You have no carts yet.</p>
  </ng-template>
</ng-container>
        <ng-container *ngIf="currentView === 'payments'">
            <h3>My Last Payments</h3>
            <!-- Payments content here -->
        </ng-container>
        <ng-container *ngIf="currentView === 'tickets'">
            <h3>My Tickets</h3>
            <!-- Tickets content here -->
        </ng-container>
    </div>
</div>



